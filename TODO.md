# WeMemory 开发路线图

## 📋 当前状态

✅ **Phase 1: 向量检索基础** (已完成)
- [x] 双向量架构
- [x] 混合检索 (BM25 + Vector)
- [x] FAISS HNSW 加速
- [x] 完整文档和示例
- [x] 开源发布

## 🎯 下一阶段目标

### Phase 2: API 服务化 (优先级: 高) ✅

#### 2.1 记忆联想 API 服务
**目标**: 将记忆联想功能封装为 REST API

**核心概念**: 不是"搜索"，而是"联想"（Recall/Association）
- 输入：当前对话上下文或线索
- 输出：智能联想到的相关记忆 + 联想原因

**任务列表**:
- [x] 技术选型
  - [x] 使用 FastAPI 框架
  - [x] 异步加载向量库（避免每次请求重新加载）
  - [x] 内存缓存机制
- [x] API 端点设计
  - [x] `POST /api/recall` - 记忆联想（核心功能）
  - [x] `POST /api/associate/topic` - 主题关联
  - [x] `POST /api/associate/people` - 人物关联
  - [x] `POST /api/associate/temporal` - 时序联想
  - [x] `POST /api/search` - 简单搜索（兼容性）
  - [x] `GET /api/stats` - 向量库统计信息
  - [x] `GET /api/health` - 健康检查
- [x] 功能实现
  - [x] 请求验证和错误处理（Pydantic）
  - [x] 联想原因生成
  - [x] 关联信息提取（人物、主题、时间）
  - [x] 结果缓存（内存缓存，TTL 1小时）
- [x] 文档
  - [x] OpenAPI/Swagger 自动文档
  - [x] API README 文档
  - [x] Python 客户端示例

**完成时间**: 2026-02-26
**实际耗时**: ~2 小时（一次性完成）

**输出文件**:
```
api/
├── main.py              # FastAPI 主应用
├── routers/
│   ├── search.py        # 搜索路由
│   └── stats.py         # 统计路由
├── models/
│   ├── request.py       # 请求模型
│   └── response.py      # 响应模型
├── services/
│   └── search_service.py # 搜索服务封装
├── requirements-api.txt
└── README.md
```

---

### Phase 3: 知识图谱构建 (优先级: 高)

> **重要决策**: 好友标签模块应该作为知识图谱的第一阶段，而不是独立模块

#### 3.1 实体识别与属性提取 (包含好友标签)

**理由**:
- 好友标签本质上是"人物实体"的属性
- 都需要 LLM 分析聊天记录
- 避免重复工作，一次性提取完整信息

**任务列表**:
- [ ] 实体识别框架
  - [ ] 设计实体 Schema
    ```
    Person (人物):
      - name: 姓名
      - aliases: 别名列表
      - relationship: 与用户的关系（好友/同事/家人/陌生人）
      - occupation: 职业
      - interests: 兴趣爱好
      - contact_info: 联系方式
      - tags: 自定义标签
      - first_met: 初次见面时间
      - last_contact: 最后联系时间

    Organization (组织):
      - name: 组织名称
      - type: 类型（公司/学校/社团）

    Location (地点):
      - name: 地点名称
      - type: 类型（城市/餐厅/景点）

    Event (事件):
      - name: 事件名称
      - time: 时间
      - participants: 参与者
    ```
  - [ ] 选择 LLM 服务
    - [ ] Google Gemini (已有配置)
    - [ ] OpenAI GPT-4 (备选)
    - [ ] 本地 LLM (长期考虑)

- [ ] 人物实体提取 (Phase 3.1.1)
  - [ ] 提示词工程
    - [ ] 设计 Few-shot 示例
    - [ ] 优化 prompt 提取准确率
  - [ ] 批量处理流程
    - [ ] 按对话分组
    - [ ] 增量更新机制（新对话只处理新内容）
  - [ ] 结果验证
    - [ ] 人工抽样检查
    - [ ] 自动一致性检查

- [ ] 其他实体提取 (Phase 3.1.2)
  - [ ] 组织实体（公司、学校等）
  - [ ] 地点实体（城市、餐厅、景点等）
  - [ ] 事件实体（聚会、会议、旅行等）

**估计时间**: 5-7 天

#### 3.2 关系抽取

**任务列表**:
- [ ] 关系类型定义
  ```
  Person-Person:
    - FRIEND_OF (好友)
    - COLLEAGUE_OF (同事)
    - FAMILY_OF (亲属)
    - CLASSMATE_OF (同学)
    - INTRODUCED_BY (介绍人关系)

  Person-Organization:
    - WORKS_AT (工作于)
    - STUDIES_AT (就读于)
    - MEMBER_OF (成员)

  Person-Event:
    - PARTICIPATED_IN (参与)
    - ORGANIZED (组织)

  Person-Location:
    - LIVES_IN (居住)
    - VISITED (访问过)
  ```

- [ ] 关系抽取实现
  - [ ] 基于 LLM 的关系抽取
  - [ ] 基于规则的关系推理
  - [ ] 关系强度评分
  - [ ] 时序关系处理

**估计时间**: 4-6 天

#### 3.3 时序事件链

**任务列表**:
- [ ] 事件时间线构建
  - [ ] 从对话中提取事件
  - [ ] 事件排序和聚合
  - [ ] 事件关联分析

- [ ] 事件模式识别
  - [ ] 周期性事件（每周例会、年度旅行等）
  - [ ] 因果事件链
  - [ ] 重要里程碑事件

**估计时间**: 3-5 天

#### 3.4 知识图谱存储

**任务列表**:
- [ ] 图数据库选型
  - [ ] Neo4j (推荐，成熟生态)
  - [ ] 或 NetworkX + 持久化 (轻量级)

- [ ] Schema 设计和实现
- [ ] CRUD 接口
- [ ] 查询优化

**估计时间**: 3-4 天

**输出文件**:
```
knowledge_graph/
├── extractors/
│   ├── entity_extractor.py    # 实体提取器
│   ├── relation_extractor.py  # 关系提取器
│   └── event_extractor.py     # 事件提取器
├── models/
│   ├── entities.py            # 实体数据模型
│   └── relations.py           # 关系数据模型
├── storage/
│   ├── graph_store.py         # 图数据库接口
│   └── neo4j_backend.py       # Neo4j 后端实现
├── prompts/
│   ├── entity_extraction.txt  # 实体提取 prompts
│   └── relation_extraction.txt
└── README.md
```

---

### Phase 4: 长期记忆模块 (优先级: 中)

**目标**: 融合向量检索和知识图谱，构建完整的记忆系统

#### 4.1 混合检索增强

**任务列表**:
- [ ] 查询路由
  - [ ] 分析查询类型（事实性 vs 语义性）
  - [ ] 自动选择检索策略

- [ ] 向量 + 图谱联合检索
  - [ ] 向量检索找对话片段
  - [ ] 图谱检索找相关实体和关系
  - [ ] 结果融合和重排序

- [ ] 上下文增强
  - [ ] 用图谱补充背景信息
  - [ ] 添加人物关系说明
  - [ ] 添加时序上下文

**示例场景**:
```
用户查询: "我和张三讨论过什么项目？"

Step 1: 实体识别 → "张三" (Person)
Step 2: 图谱查询 → 找到张三的完整信息和关系
Step 3: 向量检索 → 找到包含张三的对话片段
Step 4: 上下文增强 → 补充张三的职业、共同参与的事件等
Step 5: 结果呈现 → 带有完整背景的对话记录
```

**估计时间**: 5-7 天

#### 4.2 记忆管理机制

**任务列表**:
- [ ] 记忆重要性评分
  - [ ] 基于时间衰减
  - [ ] 基于访问频率
  - [ ] 基于情感强度
  - [ ] 基于社交关系强度

- [ ] 记忆摘要生成
  - [ ] 长对话自动摘要
  - [ ] 定期生成阶段性总结
  - [ ] 人物关系变化摘要

- [ ] 记忆验证
  - [ ] 检测矛盾信息
  - [ ] 置信度评分
  - [ ] 人工审核接口

**估计时间**: 4-6 天

#### 4.3 主动记忆触发

**任务列表**:
- [ ] 时间触发
  - [ ] 周年提醒（初次见面一年等）
  - [ ] 定期回顾（每月总结）

- [ ] 事件触发
  - [ ] 相似场景提醒
  - [ ] 关联人物出现

- [ ] 主动推荐
  - [ ] "您可能感兴趣的记忆"
  - [ ] 记忆网络可视化

**估计时间**: 3-5 天

**输出文件**:
```
memory/
├── core/
│   ├── memory_manager.py      # 记忆管理器
│   ├── hybrid_retriever.py    # 混合检索器
│   └── context_enhancer.py    # 上下文增强器
├── scoring/
│   ├── importance_scorer.py   # 重要性评分
│   └── decay_model.py         # 时间衰减模型
├── summary/
│   └── summarizer.py          # 摘要生成器
├── triggers/
│   ├── time_trigger.py        # 时间触发器
│   └── event_trigger.py       # 事件触发器
└── README.md
```

---

### Phase 5: 可视化与界面 (优先级: 中低)

#### 5.1 Web 界面

**任务列表**:
- [ ] 前端技术选型
  - [ ] React + TypeScript
  - [ ] 或 Streamlit (快速原型)

- [ ] 核心功能
  - [ ] 搜索界面
  - [ ] 知识图谱可视化（D3.js 或 Cytoscape.js）
  - [ ] 对话时间线
  - [ ] 人物关系图谱

- [ ] 管理功能
  - [ ] 实体编辑和修正
  - [ ] 标签管理
  - [ ] 导入导出

**估计时间**: 7-10 天

#### 5.2 数据可视化

**任务列表**:
- [ ] 统计图表
  - [ ] 对话频率分析
  - [ ] 关键词云
  - [ ] 关系强度热力图

- [ ] 交互式探索
  - [ ] 知识图谱 3D 可视化
  - [ ] 时间轴导航
  - [ ] 聚类可视化

**估计时间**: 3-5 天

---

## 🚀 新增功能建议

### 1. 记忆遗忘机制 (优先级: 低)
模拟人类记忆的遗忘曲线，对不重要的记忆降权

**价值**: 提升检索质量，避免噪音
**估计时间**: 2-3 天

### 2. 多模态支持 (优先级: 低)
支持图片、语音消息的记忆

**价值**: 更完整的记忆系统
**估计时间**: 5-7 天
**前置条件**: 需要图像和语音识别服务

### 3. 隐私保护增强 (优先级: 中)
端到端加密、本地化部署选项

**价值**: 用户隐私保护
**估计时间**: 4-6 天

### 4. Agent 集成 (优先级: 高)
作为 LangChain/AutoGPT 的记忆组件

**价值**: 扩展应用场景
**估计时间**: 3-5 天

### 5. 移动端支持 (优先级: 低)
React Native 或 Flutter 应用

**价值**: 随时访问记忆
**估计时间**: 10-15 天

---

## 📅 里程碑规划

### Milestone 1: API 服务 (2 周)
- ✅ Query API 完成
- ✅ 基本部署文档
- ✅ 性能测试

### Milestone 2: 知识图谱 V1 (4-6 周)
- ✅ 实体识别完成（包含好友标签）
- ✅ 关系抽取完成
- ✅ 基础查询功能
- ✅ 与向量检索集成

### Milestone 3: 长期记忆 V1 (2-3 周)
- ✅ 混合检索增强
- ✅ 记忆管理机制
- ✅ 基础触发功能

### Milestone 4: 可视化界面 (3-4 周)
- ✅ Web 界面上线
- ✅ 知识图谱可视化
- ✅ 用户文档完善

---

## 🤔 需要讨论的问题

### 1. 好友标签 vs 知识图谱（你提到的第2点）

**我的建议**: **合并到知识图谱 Phase 3.1**

**理由**:
1. **避免重复**: 都需要 LLM 分析同样的聊天记录
2. **数据一致性**: 好友信息本就是知识图谱的核心部分
3. **扩展性更好**: 一次性提取人物的完整属性，而不只是标签
4. **技术栈统一**: 使用同一套实体识别框架

**具体方案**:
```
Phase 3.1: 实体识别（优先级：人物实体）
  ↓
Step 1: 识别所有人物（好友、提到的人等）
Step 2: 提取人物属性
  - 基础属性：姓名、别名
  - 关系属性：与用户的关系类型
  - 描述属性：职业、兴趣、性格等
  - 元数据：首次出现、最后联系时间
Step 3: 生成人物档案卡
```

**你觉得这个方案如何？还是你更倾向于先做一个简单的标签模块，后续再集成？**

### 2. LLM 服务选择

现在有 Google Vertex AI 配置，但知识图谱可能需要更强的推理能力。

**选项**:
- A. 继续用 Google Gemini（成本低，已配置）
- B. 使用 OpenAI GPT-4（效果好，成本高）
- C. 混合使用（简单任务用 Gemini，复杂任务用 GPT-4）

**你的偏好？**

### 3. 知识图谱存储

**选项**:
- A. Neo4j（功能强大，但需要额外服务）
- B. NetworkX + Pickle（轻量级，但查询能力有限）
- C. SQLite + JSON（折中方案）

**考虑因素**: 数据规模、查询复杂度、部署便捷性

**你的想法？**

### 4. API 优先 vs 知识图谱优先

**方案 A**: 先做 API（2 周），快速提供搜索服务，再做知识图谱
**方案 B**: 先做知识图谱（6 周），一次性构建完整能力，再封装 API

**你更倾向哪个？**

---

## 📝 下一步行动

请确认：
1. 是否同意将"好友标签"合并到知识图谱 Phase 3.1？
2. 优先级顺序是否合理？需要调整吗？
3. 对上述讨论问题的选择
4. 是否有其他想法或需求？

确认后，我们可以：
1. 创建详细的技术设计文档
2. 开始第一个 Milestone 的开发
3. 设置项目管理看板（GitHub Projects）

---

**文档版本**: v1.0
**创建时间**: 2026-02-26
**最后更新**: 2026-02-26
